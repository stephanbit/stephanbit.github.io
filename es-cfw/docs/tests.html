<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tests and Mocking the API | ES Client Framework 3.0</title>
    <meta name="description" content="Client Framework to build SPAs based on VueJS 3">
    <link rel="icon" href="/logo.gif">
    
    <link rel="preload" href="/assets/css/styles.48cc1433.css" as="style"><link rel="preload" href="/assets/js/app.48cc1433.js" as="script"><link rel="preload" href="/assets/js/14.66ac1e9f.js" as="script"><link rel="prefetch" href="/assets/js/5.891d1674.js"><link rel="prefetch" href="/assets/css/1.styles.564f899c.css"><link rel="prefetch" href="/assets/js/1.564f899c.js"><link rel="prefetch" href="/assets/css/2.styles.b6c75968.css"><link rel="prefetch" href="/assets/js/2.b6c75968.js"><link rel="prefetch" href="/assets/js/3.a0b6963c.js"><link rel="prefetch" href="/assets/js/4.e6108de9.js"><link rel="prefetch" href="/assets/js/6.fe9b891c.js"><link rel="prefetch" href="/assets/js/7.19eba298.js"><link rel="prefetch" href="/assets/js/8.02ad7b33.js"><link rel="prefetch" href="/assets/js/9.43db4cfe.js"><link rel="prefetch" href="/assets/js/10.2a4556f6.js"><link rel="prefetch" href="/assets/js/11.952afd5e.js"><link rel="prefetch" href="/assets/js/12.6103c6c0.js"><link rel="prefetch" href="/assets/js/13.57438a5c.js"><link rel="prefetch" href="/assets/js/15.71866b31.js">
    <link rel="stylesheet" href="/assets/css/styles.48cc1433.css"><link rel="stylesheet" href="/assets/css/1.styles.564f899c.css"><link rel="stylesheet" href="/assets/css/2.styles.b6c75968.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ES Client Framework 3.0</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/tribe/" class="nav-link">Tribe</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bitbucket
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/tribe/" class="nav-link">Tribe</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bitbucket
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Introduction</a></li><li><a href="/docs/development.html" class="sidebar-link">Setup and Development</a></li><li><a href="/docs/components.html" class="sidebar-link">Development Components</a></li><li><a href="/docs/architecture.html" class="sidebar-link">Structure</a></li><li><a href="/docs/tech.html" class="sidebar-link">Languages and Technologies</a></li><li><a href="/docs/routing.html" class="sidebar-link">Routing, Layouts and Views</a></li><li><a href="/docs/state.html" class="sidebar-link">State Management</a></li><li><a href="/docs/tests.html" class="active sidebar-link">Tests and Mocking the API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/tests.html#running-all-tests" class="sidebar-link">Running all Tests</a></li><li class="sidebar-sub-header"><a href="/docs/tests.html#unit-tests-with-jest" class="sidebar-link">Unit Tests with Jest</a></li><li class="sidebar-sub-header"><a href="/docs/tests.html#end-to-end-tests-with-cypress" class="sidebar-link">End-to-End Tests with Cypress</a></li><li class="sidebar-sub-header"><a href="/docs/tests.html#the-mock-api" class="sidebar-link">The Mock API</a></li></ul></li><li><a href="/docs/linting.html" class="sidebar-link">Linting &amp; Formatting</a></li><li><a href="/docs/editors.html" class="sidebar-link">Editor integration</a></li><li><a href="/docs/production.html" class="sidebar-link">Building and Deploying to Production</a></li><li><a href="/docs/troubleshooting.html" class="sidebar-link">Troubleshooting</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="tests-and-mocking-the-api"><a href="#tests-and-mocking-the-api" aria-hidden="true" class="header-anchor">#</a> Tests and Mocking the API</h1> <ul><li><a href="#tests-and-mocking-the-api">Tests and Mocking the API</a> <ul><li><a href="#running-all-tests">Running all Tests</a></li> <li><a href="#unit-tests-with-jest">Unit Tests with Jest</a> <ul><li><a href="#running-unit-tests">Running Unit Tests</a></li> <li><a href="#introduction-to-jest">Introduction to Jest</a></li> <li><a href="#unit-test-files">Unit Test Files</a></li> <li><a href="#unit-test-helpers">Unit Test Helpers</a></li> <li><a href="#unit-test-mocks">Unit Test Mocks</a></li></ul></li> <li><a href="#end-to-end-tests-with-cypress">End-to-End Tests with Cypress</a> <ul><li><a href="#running-end-to-end-tests">Running end-to-end Tests</a></li> <li><a href="#introduction-to-cypress">Introduction to Cypress</a></li> <li><a href="#accessibility-driven-end-to-end-tests">Accessibility-driven end-to-end Tests</a></li></ul></li> <li><a href="#the-mock-api">The Mock API</a> <ul><li><a href="#testingdeveloping-against-a-real-server">Testing/Developing against a real Server</a></li></ul></li></ul></li></ul> <h2 id="running-all-tests"><a href="#running-all-tests" aria-hidden="true" class="header-anchor">#</a> Running all Tests</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Run all tests</span>
yarn <span class="token function">test</span>
</code></pre></div><h2 id="unit-tests-with-jest"><a href="#unit-tests-with-jest" aria-hidden="true" class="header-anchor">#</a> Unit Tests with Jest</h2> <h3 id="running-unit-tests"><a href="#running-unit-tests" aria-hidden="true" class="header-anchor">#</a> Running Unit Tests</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Run unit tests</span>
yarn unit

<span class="token comment"># Run unit tests in watch mode</span>
yarn unit:watch
</code></pre></div><h3 id="introduction-to-jest"><a href="#introduction-to-jest" aria-hidden="true" class="header-anchor">#</a> Introduction to Jest</h3> <p>For unit tests, we use Jest with the <code>describe</code>/<code>expect</code> syntax. If you're not familiar with Jest, I recommend first browsing through the existing tests to get a sense for them.</p> <p>Then at the very least, read about:</p> <ul><li><a href="https://facebook.github.io/jest/docs/en/expect.html" target="_blank" rel="noopener noreferrer">Jest's matchers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for examples of other assertions you can make</li> <li><a href="https://facebook.github.io/jest/docs/en/asynchronous.html" target="_blank" rel="noopener noreferrer">Testing async code<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://facebook.github.io/jest/docs/en/setup-teardown.html" target="_blank" rel="noopener noreferrer">Setup and teardown<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="unit-test-files"><a href="#unit-test-files" aria-hidden="true" class="header-anchor">#</a> Unit Test Files</h3> <p>Configuration for Jest is in <code>jest.config.js</code>, support files are in <code>tests/unit</code>, but as for the tests themselves - they're first-class citizens.
That means they live alongside our source files, using the same name as the file they test, but with the extension <code>.unit.js</code>.</p> <p>This may seem strange at first, but it makes poor test coverage obvious from a glance, even for those less familiar with the project.
It also lowers the barrier to adding tests before creating a new file, adding a new feature, or fixing a bug.</p> <h3 id="unit-test-helpers"><a href="#unit-test-helpers" aria-hidden="true" class="header-anchor">#</a> Unit Test Helpers</h3> <p>See <a href="../tests/unit/setup.js"><code>tests/unit/setup.js</code></a> for a list of helpers, including documentation in comments.</p> <h3 id="unit-test-mocks"><a href="#unit-test-mocks" aria-hidden="true" class="header-anchor">#</a> Unit Test Mocks</h3> <p>Jest offers many tools for mocks, including:</p> <ul><li><a href="https://facebook.github.io/jest/docs/en/mock-functions.html" target="_blank" rel="noopener noreferrer">For a function<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, use <code>jest.fn()</code>.</li> <li><a href="https://facebook.github.io/jest/docs/en/manual-mocks.html#mocking-user-modules" target="_blank" rel="noopener noreferrer">For a source file<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, add the mock to a <code>__mocks__</code> directory adjacent to the file.</li> <li><a href="https://facebook.github.io/jest/docs/en/manual-mocks.html#mocking-node-modules" target="_blank" rel="noopener noreferrer">For a dependency in <code>node_modules</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, add the mock to <code>tests/unit/__mocks__</code>. You can see an example of this with the <code>axios</code> mock, which intercepts requests with relative URLs to either <a href="#the-mock-api">our mock API</a> or a local/live API if the <code>API_BASE_URL</code> environment variable is set.</li></ul> <h2 id="end-to-end-tests-with-cypress"><a href="#end-to-end-tests-with-cypress" aria-hidden="true" class="header-anchor">#</a> End-to-End Tests with Cypress</h2> <h3 id="running-end-to-end-tests"><a href="#running-end-to-end-tests" aria-hidden="true" class="header-anchor">#</a> Running end-to-end Tests</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Run end to end tests</span>
yarn e2e

<span class="token comment"># Run the dev server with the Cypress client</span>
yarn dev:e2e
</code></pre></div><h3 id="introduction-to-cypress"><a href="#introduction-to-cypress" aria-hidden="true" class="header-anchor">#</a> Introduction to Cypress</h3> <p>Cypress offers many advantages over other test frameworks, including the abilities to:</p> <ul><li>Travel through time to dissect the source of a problem when a test fails</li> <li>Automatically record video and screenshots of your tests</li> <li>Easily test in a wide range of screen sizes</li></ul> <p>And much more! I recommend checking out our Cypress tests in <code>tests/e2e/specs</code>, then reading through at least these sections of the excellent Cypress docs:</p> <ul><li><a href="https://docs.cypress.io/guides/core-concepts/introduction-to-cypress.html#Cypress-Is-Simple" target="_blank" rel="noopener noreferrer">Core Concepts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.cypress.io/guides/references/best-practices.html" target="_blank" rel="noopener noreferrer">Best Practices<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Beyond that, also know that you can access our app in Cypress on the <code>window</code>. For example, to dispatch a Vuex action that sets up some state:</p> <div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>window <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> window<span class="token punctuation">.</span>__app__<span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'someModule/someAction'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="accessibility-driven-end-to-end-tests"><a href="#accessibility-driven-end-to-end-tests" aria-hidden="true" class="header-anchor">#</a> Accessibility-driven end-to-end Tests</h3> <p>Ideally, tests should only fail when either:</p> <ul><li>something is actually broken, or</li> <li>the requirements have changed</li></ul> <p>Unfortunately, there are <em>a lot</em> of ways to get this wrong. For example, when creating a selector for a login link:</p> <div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token comment">// Too general, as there could be many links</span>

cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'.login-link'</span><span class="token punctuation">)</span>
<span class="token comment">// Tied to implementation detail of CSS</span>

cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'#login-link'</span><span class="token punctuation">)</span>
<span class="token comment">// Tied to implementation detail of JS and prevents component reusability</span>

cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'Log in'</span><span class="token punctuation">)</span>
<span class="token comment">// Assumes the text only appears in one context</span>
</code></pre></div><p>To create the right selector, think from the perspective of the user. What <em>exactly</em> are they looking for? They're not looking for:</p> <div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token comment">// Any link</span>

cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'.login-link'</span><span class="token punctuation">)</span>
<span class="token comment">// An element with a specific class</span>

cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'#login-link'</span><span class="token punctuation">)</span>
<span class="token comment">// An element with a specific id</span>

cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'Log in'</span><span class="token punctuation">)</span>
<span class="token comment">// Specific text anywhere on the page</span>
</code></pre></div><p>But rather:</p> <div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'Log in'</span><span class="token punctuation">)</span>
<span class="token comment">// A link containing the text &quot;Log in&quot;</span>
</code></pre></div><p>Note that we're targeting a <strong>semantic element</strong>, meaning that it tells the web browser (and users) something about the element's role within the page. Also note that we're trying to be <strong>as general as possible</strong>. We're not looking for the link in a specific place, like a navbar or sidebar (unless that's part of the requirements), and we're not overly specific with the content. The link may also contain other content, like an icon, but that won't break the test, because we only care that <em>some link</em> contains the text &quot;Log in&quot; <em>somewhere</em> inside it.</p> <p>Now, some will be thinking:</p> <blockquote><p>&quot;But isn't this brittle? Wouldn't it be better to add another attribute to the link, like <code>data-testid=&quot;login-link</code>? Then we could target that attribute and even if the element or content changes, the test won't break.&quot;</p></blockquote> <p>I would argue that if the link's semantic element or content changes so drastically that it's no longer an anchor and doesn't even contain the text &quot;Log in&quot; anymore, the requirements <em>have</em> changed, so the test <em>should</em> break. And from an accessibility perspective, the app might indeed be broken.</p> <p>For example, let's imagine you replaced &quot;Log in&quot; with an icon:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/login<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>icon icon-login<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Now users browsing your page with a screen reader will have no way to find the login link. From their perspective, this is just a link with no content. You may be tempted to try to fix the test with something like:</p> <div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'a[href=&quot;/login&quot;]'</span><span class="token punctuation">)</span>
<span class="token comment">// A link going to &quot;/login&quot;</span>
</code></pre></div><p>But when you're trying to find a login link as a user, you don't just inspect the destination of unlabeled links until you find one that looks like it's possibly a login page. That would be a very slow and painful experience!</p> <p>Instead, thinking from a user's perspective forces you to stay accessible, perhaps updating your generated HTML to:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span>
  <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Log in<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/login<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>
    <span class="token attr-name">aria-hidden</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>icon icon-login<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Then the selector in your test can update as well:</p> <div class="language-js extra-class"><pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'a[aria-label*=&quot;Log in&quot;]'</span><span class="token punctuation">)</span>
<span class="token comment">// A link with a label containing the text &quot;Log in&quot;</span>
</code></pre></div><p>And the app now works for everyone:</p> <ul><li>Sighted users will see an icon that they'll (hopefully) have the cultural context to interpret as &quot;Log in&quot;.</li> <li>Non-sighted users get a label with the text &quot;Log in&quot; read to them.</li></ul> <p>This strategy could be called <strong>accessibility-driven end-to-end tests</strong>, because you're parsing your own app with the same mindset as your users. It happens to be great for accessibility, but also helps to ensure that your app always breaks when requirements change, but never when you've just changed the implementation.</p> <h2 id="the-mock-api"><a href="#the-mock-api" aria-hidden="true" class="header-anchor">#</a> The Mock API</h2> <p>Working against the production API can be useful sometimes, but it also has some disadvantages:</p> <ul><li>Networks requests are slow, which slows down both development and testing.</li> <li>Development and testing become dependent on a stable network connection.</li> <li>Hitting the production API often means modifying the production database, which you typically don't want to do during automated tests.</li> <li>To work on a frontend feature, the backend for it must already be complete.</li></ul> <p>The mock API is an <a href="https://expressjs.com/" target="_blank" rel="noopener noreferrer">Express<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> server in <code>tests/mock-api</code> you can extend to - you guessed it - mock what the real API would do, solving all the problems listed above. This solution is also backend-agnostic, making it ideal for a wide variety of projects.</p> <h3 id="testing-developing-against-a-real-server"><a href="#testing-developing-against-a-real-server" aria-hidden="true" class="header-anchor">#</a> Testing/Developing against a real Server</h3> <p>In some situations, you might prefer to test against a local server while developing, or maybe just during continuous integration. To do so, you can run any development or test command with the <code>API_BASE_URL</code> environment variable. For example:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>API_BASE_URL<span class="token operator">=</span>http://localhost:3000 yarn <span class="token function">test</span>
</code></pre></div><p>Or similarly, with a live server:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>API_BASE_URL<span class="token operator">=</span>https://staging.example.io yarn <span class="token function">test</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docs/state.html" class="prev">
          State Management
        </a></span> <span class="next"><a href="/docs/linting.html">
          Linting &amp; Formatting
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/14.66ac1e9f.js" defer></script><script src="/assets/js/app.48cc1433.js" defer></script>
  </body>
</html>
